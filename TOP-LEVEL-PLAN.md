# Gateway Layered Protocol - 跨域 Agent 联调工具

**一句话定位**: 主网关统一指挥，辅网关分布式执行，支持跨域团队协作的 Agent 通信基础设施。

---

## 🎯 核心价值

| 场景 | 解决方案 |
|------|----------|
| **跨域协作** | 主网关→辅网关任务下发 |
| **团队联调** | 8-Agent 团队指挥副团队 |
| **分布式执行** | 分支节点本地执行 |
| **统一监控** | 主网关状态仪表盘 |

---

## 🏗️ 架构概览

```
┌─────────────────────────────────────────────────────────┐
│                    主网关（Main Gateway）                 │
│  🎯 统一指挥 + 📊 状态监控 + 📡 任务分发                  │
│  端口：18789 (Agent) + 18790 (管理)                      │
│                                                           │
│  ┌────────────────────────────────────────────────────┐ │
│  │  Web 管理界面 (黑色风格 UI)                          │ │
│  │  - 网关状态监控                                      │ │
│  │  - 任务下发面板                                      │ │
│  │  - 实时日志查看                                      │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│  辅网关 A     │  │  辅网关 B     │  │  分支节点    │
│  (服务器 B)   │  │  (服务器 C)   │  │  (服务器 D)   │
│  接收任务     │  │  接收任务     │  │  本地执行     │
│  返回结果     │  │  返回结果     │  │  返回结果     │
└──────────────┘  └──────────────┘  └──────────────┘
```

---

## 📦 交付物

| 模块 | 内容 | 状态 |
|------|------|------|
| **后端** | Gateway 核心（TypeScript） | ✅ 完成 |
| **前端** | Web 管理界面（黑色风格） | ✅ 完成 |
| **协议** | 网关注册/心跳/任务下发 | ✅ 完成 |
| **文档** | README + 快速开始 | ⏳ 待精简 |

---

## 🚀 5 分钟快速开始

```bash
# 1. 安装依赖
npm install

# 2. 启动主网关（带 Web UI）
npm run dev:main

# 3. 打开浏览器
http://localhost:18790

# 4. 启动辅网关（新终端）
npm run dev:aux
```

---

## 🎨 前端 UI 设计

### 页面结构

```
┌──────────────────────────────────────────────────────┐
│  Gateway Manager                    🟢 运行中         │
├──────────────────────────────────────────────────────┤
│                                                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  已连接网关  │  │  活跃任务    │  │  今日请求    │  │
│  │     3       │  │     12      │  │    1,234    │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
│                                                       │
│  ┌─────────────────────────────────────────────────┐ │
│  │  网关列表                                        │ │
│  │  ┌─────────────────────────────────────────┐   │ │
│  │  │ gw-auxiliary-001  🟢 在线  CPU: 45%     │   │ │
│  │  │ gw-auxiliary-002  🟢 在线  CPU: 32%     │   │ │
│  │  │ gw-branch-001     🟡 离线  最后：5 分钟前  │   │ │
│  │  └─────────────────────────────────────────┘   │ │
│  └─────────────────────────────────────────────────┘ │
│                                                       │
│  ┌─────────────────────────────────────────────────┐ │
│  │  任务下发                                        │ │
│  │  目标网关：[下拉选择 ▼]                          │ │
│  │  Agent ID: [dev ▼]                              │ │
│  │  命令：[code-review ▼]                          │ │
│  │  参数：{"repo": "..."}                          │ │
│  │                            [发送任务]            │ │
│  └─────────────────────────────────────────────────┘ │
│                                                       │
│  ┌─────────────────────────────────────────────────┐ │
│  │  实时日志                                        │ │
│  │  [12:30:45] 网关注册：gw-auxiliary-001          │ │
│  │  [12:31:00] 任务下发：task-001 → dev            │ │
│  │  [12:32:15] 任务完成：task-001 (success)        │ │
│  └─────────────────────────────────────────────────┘ │
│                                                       │
└──────────────────────────────────────────────────────┘
```

### 技术栈

| 技术 | 选型 | 说明 |
|------|------|------|
| **框架** | React + Vite | 轻量快速 |
| **样式** | Tailwind CSS | 黑色主题 |
| **通信** | WebSocket | 实时连接 |
| **图表** | Recharts | 状态可视化 |

---

## 📅 开发计划

| 阶段 | 时间 | 交付物 | 状态 |
|------|------|--------|------|
| **Phase 1** | Day 1-2 | 后端核心 + 协议 | ✅ 完成 |
| **Phase 2** | Day 3 | 前端 UI（黑色风格） | ✅ 完成 |
| **Phase 3** | Day 4 | 测试 + 文档精简 | ⏳ 进行中 |
| **Phase 4** | Day 5-6 | GitHub 发布 | ⏳ 待开始 |

**预计结项**: 2026-03-05

---

## 🔗 GitHub 发布计划

### 仓库结构

```
gateway-layered-protocol/
├── README.md              # 精简版（5 分钟读懂）
├── QUICKSTART.md          # 快速开始
├── package.json
├── src/
│   ├── gateway.ts         # 核心网关
│   ├── main-gateway.ts    # 主网关
│   ├── auxiliary-gateway.ts # 辅网关
│   ├── protocol/          # 协议定义
│   └── web/               # 前端 UI
│       ├── App.tsx
│       ├── components/
│       └── styles/
└── examples/              # 使用示例
```

### README 核心内容

1. **一句话介绍** - 这是什么
2. **5 分钟快速开始** - 立即能用
3. **架构图** - 一眼看懂
4. **核心 API** - 3 个主要接口
5. **示例代码** - 复制即用

---

## 🧹 清理计划

| 操作 | 说明 |
|------|------|
| **删除冗余文档** | 保留顶层方案，删除过程文档 |
| **精简代码注释** | 保留关键注释，删除啰嗦说明 |
| **统一命名** | 文件/变量/函数统一风格 |
| **合并重复代码** | 提取公共模块 |

---

**版本**: v1.0  
**状态**: 🟢 顶层方案  
**更新**: 2026-02-26
